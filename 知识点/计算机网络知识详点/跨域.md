# 跨域知识详点

### dns 解析过程
 1.客服端向本地域名服务器发出请求，请求域名对应IP地址

 2.本地dns服务器向dns根服务器发出请求，根DNS服务器会告诉本地dns服务器（.com）的地址

 3 本地dns服务器向 .com 域发送请求，得到二级域名的地址

 4 以次类推 ，最后得到IP地址


### 同源策略
浏览器对网络请求有同源限制，同源即协议，端口，域名必须一样。b不同源的客户端脚本在没有明确授权的情况下，不能读写对方XHR 的资源。


### 跨域饿解决方案

+ jsonp:只支持 GET ，不支持post，不安全,容易引发xss攻击（跨站脚本攻击）。
+ psotMessage：配合使用iframe，需要兼容ie 9以下
+ document.domain:仅限于同一域名下的子域
+ cors:需要后端配合进行相关的设置
+ weksocket: 需要后端配合修改协议
+ proxy:使用代理去避开跨域请求。需要修改nginx,apache等的配置

#### jsonp
浏览器对script标签src属性，link标签ref属性和img标签src 属性没有同源限制，所以可以将请求放在script标签src属性中。如下：

    //jsonp
    function jsonp(url,params,cb){
        return new Promise((resolve,reject) => {
            window[cb] = function(data){
                resolve(data);
                document.body.removeChild(script);
            }
            parmas = {...parmas,cb},
            let arrs = [];
            for(let key in params){
                arrs.push(`${key}=${params[key]}`)
            }
            let script = document.createElement('script');
            script.src = url + '?' + arrs.join('&');
            document.body.appendChild(script)
        })
    }

#### proxy 

    //nginx.conf
    location / {
        root;
        index index.html index.htm;
    }
    location ~.*\.json {
        root json;
        add_header "Access-Control-Allow-Origin" "*";
    }

    
